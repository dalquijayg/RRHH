<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Departamentos - Recursos Humanos</title>
    <link rel="stylesheet" href="../Disenos/ActualizarDep.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Header con logo y navegación -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="../Imagenes/LogoDennis.png" alt="New Technology Logo" class="brand-logo">
                <div class="page-title">
                    <h1>Gestión de Departamentos</h1>
                    <p>Sistema de Recursos Humanos</p>
                </div>
            </div>
            
            <div class="user-section">
                <div class="user-info">
                    <img src="../Imagenes/user-default.png" alt="Usuario" class="user-avatar" id="userAvatar">
                    <div class="user-details">
                        <span class="user-name" id="userName">Usuario</span>
                        <span class="user-role" id="userRole">Administrador</span>
                    </div>
                </div>
                <button class="btn-logout" id="btnLogout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="main-content">
        <!-- Barra de herramientas -->
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn btn-primary" id="btnAgregar">
                    <i class="fas fa-plus"></i>
                    Agregar Departamento
                </button>
                <button class="btn btn-secondary" id="btnRefrescar">
                    <i class="fas fa-refresh"></i>
                    Refrescar
                </button>
            </div>
            
            <div class="toolbar-right">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Buscar departamento..." class="search-input">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <button class="btn btn-outline" id="btnFiltros">
                    <i class="fas fa-filter"></i>
                    Filtros
                </button>
            </div>
        </div>

        <!-- Contenedor de la tabla -->
        <div class="table-container">
            <div class="table-header">
                <h2>Lista de Departamentos</h2>
                <div class="table-info">
                    <span class="record-count">Total: <span id="recordCount">0</span> registros</span>
                </div>
            </div>

            <!-- Tabla scrolleable -->
            <div class="table-wrapper">
                <table class="data-table" id="departamentosTable">
                    <thead>
                        <tr>
                            <th data-sort="IdDepartamento" class="sortable">
                                ID
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th data-sort="NombreDepartamento" class="sortable">
                                Nombre Departamento
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th data-sort="NombreRegion" class="sortable">
                                Región
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th data-sort="PlanFijo" class="sortable text-center">
                                Cantidad Plan Fijo
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th data-sort="PlanParcial" class="sortable text-center">
                                Cantidad Plan Parcial
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th data-sort="PlanVacacionista" class="sortable text-center">
                                Cantidad Plan Vacacionista
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="actions-column">
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Los datos se cargarán dinámicamente aquí -->
                        <tr class="loading-row">
                            <td colspan="7" class="text-center">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Cargando datos...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Footer de la tabla con paginación -->
            <div class="table-footer">
                <div class="pagination-info">
                    Mostrando <span id="showingStart">1</span> a <span id="showingEnd">10</span> de <span id="totalRecords">0</span> registros
                </div>
                
                <div class="pagination-controls">
                    <select id="pageSize" class="page-size-select">
                        <option value="10">10 por página</option>
                        <option value="25">25 por página</option>
                        <option value="50">50 por página</option>
                        <option value="100">100 por página</option>
                    </select>
                    
                    <div class="pagination-buttons">
                        <button class="btn-pagination" id="btnFirst" disabled>
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="btn-pagination" id="btnPrev" disabled>
                            <i class="fas fa-angle-left"></i>
                        </button>
                        
                        <div class="page-numbers" id="pageNumbers">
                            <!-- Los números de página se generarán dinámicamente -->
                        </div>
                        
                        <button class="btn-pagination" id="btnNext">
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="btn-pagination" id="btnLast">
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para gestión de puestos -->
    <div class="modal-overlay" id="modalPuestos" style="display: none;">
        <div class="modal-container modal-large">
            <div class="modal-header">
                <h2 id="modalPuestosTitle">Gestión de Puestos</h2>
                <button class="modal-close" id="btnCerrarModalPuestos">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-content">
                <!-- Información del departamento -->
                <div class="department-info">
                    <div class="dept-card">
                        <div class="dept-header">
                            <h3 id="deptNombre">Departamento</h3>
                            <span class="dept-region" id="deptRegion">Región</span>
                        </div>
                        <div class="dept-stats">
                            <div class="stat-item">
                                <span class="stat-label">Plan Fijo</span>
                                <span class="stat-value" id="deptPlanFijo">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Plan Parcial</span>
                                <span class="stat-value" id="deptPlanParcial">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Plan Vacacionista</span>
                                <span class="stat-value" id="deptPlanVacacionista">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Toolbar para puestos -->
                <div class="puestos-toolbar">
                    <div class="toolbar-left">
                        <button class="btn btn-primary" id="btnAgregarPuesto">
                            <i class="fas fa-plus"></i>
                            Agregar Puesto
                        </button>
                        <button class="btn btn-info" id="btnRefrescarPuestos">
                            <i class="fas fa-refresh"></i>
                            Refrescar
                        </button>
                    </div>
                    
                    <div class="toolbar-right">
                        <div class="search-container">
                            <input type="text" id="searchPuestos" placeholder="Buscar puesto..." class="search-input search-small">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </div>

                <!-- Tabla de puestos -->
                <div class="puestos-table-container">
                    <div class="table-wrapper table-modal">
                        <table class="data-table" id="puestosTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre del Puesto</th>
                                    <th class="text-center">Colaboradores</th>
                                    <th class="text-center">Pago Dominical</th>
                                    <th class="text-center">Pago Días Especiales</th>
                                    <th class="actions-column">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="puestosTableBody">
                                <tr class="loading-row">
                                    <td colspan="6" class="text-center">
                                        <div class="loading-spinner">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Cargando puestos...
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Información de colaboradores por puesto -->
                <div class="colaboradores-section" id="colaboradoresSection" style="display: none;">
                    <div class="section-header">
                        <h3>Colaboradores en el puesto: <span id="puestoSeleccionado"></span></h3>
                        <button class="btn btn-outline btn-small" id="btnOcultarColaboradores">
                            <i class="fas fa-eye-slash"></i>
                            Ocultar
                        </button>
                    </div>
                    
                    <div class="colaboradores-grid" id="colaboradoresGrid">
                        <!-- Se llenarán dinámicamente -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btnCerrarPuestos">
                    <i class="fas fa-times"></i>
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Elementos decorativos de fondo (sutiles) -->
    <div class="bg-decoration bubble bubble1"></div>
    <div class="bg-decoration bubble bubble2"></div>
    <div class="bg-decoration bubble bubble3"></div>
    <div class="bg-decoration pattern pattern1"></div>
    <div class="bg-decoration pattern pattern2"></div>

    <!-- Scripts -->
    <script src="../Logica/ActualizarDep.js"></script>
    <script>
        const { ipcRenderer } = require('electron');
        
        // Cargar información del usuario desde localStorage
        document.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            if (userData.NombreCompleto) {
                document.getElementById('userName').textContent = userData.NombreCompleto;
                
                if (userData.FotoBase64) {
                    document.getElementById('userAvatar').src = userData.FotoBase64;
                }
                
                // Determinar rol
                let rol = 'Colaborador';
                if (userData.Id_Puesto == 5) {
                    rol = 'Administrador RRHH';
                } else if (userData.Id_Puesto == 1) {
                    rol = 'Gerente';
                }
                document.getElementById('userRole').textContent = rol;
            }
        });

        // Manejar logout
        document.getElementById('btnLogout').addEventListener('click', () => {
            localStorage.removeItem('userData');
            window.location.href = 'Login.html';
        });
    </script>
</body>
</html>